# Specification: Shared Schemas & Types

**Issue**: #1
**Status**: draft

## Overview

Define all shared Zod schemas and TypeScript types that every module in the knowledge server depends on. These schemas serve as the single source of truth for data shapes across auth, retrieval, API, sync, consumer, and MCP modules. Zod schemas are shared between the REST API (via @hono/zod-openapi) and MCP tool definitions.

## Requirements

### Must Have
- [ ] Content schemas: BaseSchema, ArtifactSchema, TagSchema, ContentEntry (with id, contentType, path, metadata, content, syncedAt, commitSha)
- [ ] Content type hierarchy enum: note, reference, link, tag, artifact, article, guide, pattern, playbook
- [ ] Auth schemas: AccessTier (public | member | vibecoder), HatsRole (isContributor, isMember, tier), AuthProps (address, tier, roles, ensName, chainId)
- [ ] API schemas: SearchParams (q, limit, contentType), ListParams (limit, offset, contentType, category), APIResponse envelope (data + meta), ErrorResponse (error.code + error.message)
- [ ] Storage schemas: R2Document (id, contentType, path, metadata, content, syncedAt, commitSha), VectorizeRecord metadata shape (contentType, status, publish, category, createdAt, title, syncedAt)
- [ ] Sync schemas: SyncParams (changedFiles, deletedFiles, commitSha), R2EventNotification shape
- [ ] MCP tool input schemas: search_knowledge, define_term, search_lexicon, get_document, add_term, save_link, update_term
- [ ] All schemas use Zod v4
- [ ] Barrel export via index.ts

### Should Have
- [ ] OpenAPI-compatible schemas (using .openapi() method from @hono/zod-openapi)
- [ ] Inferred TypeScript types exported alongside Zod schemas (z.infer<>)
- [ ] SearchResult schema with score field for reranked results
- [ ] PaginatedResponse generic wrapper

### Won't Have
- Runtime validation middleware (that's Package 3's job)
- Cloudflare binding type definitions (auto-generated by cf-typegen)
- Implementation logic of any kind

## Acceptance Criteria

- [ ] `npm run type-check` passes with zero errors
- [ ] Every schema can be imported from `src/types/index.ts`
- [ ] Schemas match the data shapes defined in tmp/spec.md sections 2-9
- [ ] Content type enum covers the full hierarchy from spec section 3.2
- [ ] Auth tier values match Hats Protocol paths from spec section 2.4

## User Stories

As a module developer, I want to import shared types from a single location so that all modules use consistent data shapes.

As a REST API developer, I want Zod schemas with .openapi() annotations so that @hono/zod-openapi can auto-generate the OpenAPI spec.

As an MCP tool developer, I want the same Zod schemas used for tool input validation so that REST and MCP share identical contracts.

## Edge Cases

| Case | Handling |
|------|----------|
| Zod v4 vs v3 API differences | Use Zod v4 API (z4.3.6 in package.json) â€” check for any breaking changes |
| @hono/zod-openapi compatibility with Zod v4 | Verify .openapi() method works with installed version |
| Optional frontmatter fields | Use .optional() with sensible defaults where spec defines them |
| Content type inference from file path | Define a mapping type, not runtime logic |
